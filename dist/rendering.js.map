{"version":3,"sources":["../src/rendering.js"],"names":["_","$","EChartRendering","scope","elem","attrs","ctrl","panel","jchart","find","init","events","on","onRender","bind","loadPlugins","e","console","error","id","src","endsWith","createScript","createLink","append","plugins","filter","p","length","map","loadAsset","html","remove","options","getChartOptions","initEchart","echart","setOption","resize","echarts","theme","renderer","render","incrementRenderCounter","data","raw","noDataPoints","undefined","setTimeout","clearWarning","addechart","renderingCompleted"],"mappings":"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","file":"rendering.js","sourcesContent":["import _ from 'lodash';\nimport $ from 'jquery';\nimport 'jquery.flot';\nimport 'jquery.flot.pie';\nimport './lib/jquery.json-editor.min';\n//import echarts from './lib/echarts/echarts.min';\n//import liquidfill from './lib/echarts/liquidfill.min';\n\nexport default class EChartRendering {\n  constructor(scope, elem, attrs, ctrl) {\n    this.panel = ctrl.panel;\n    this.elem = elem;\n    this.jchart = elem.find('.echart-panel__chart');\n    this.ctrl = ctrl;\n    this.scope = scope;\n    this.init();\n  }\n\n  init() {\n    this.ctrl.events.on('render', this.onRender.bind(this));\n    try{\n      this.loadPlugins();\n    }catch(e){\n      console.error(e);\n    }\n  }\n\n  loadAsset(id, src) {\n    src.endsWith(\".js\") ?\n      this.createScript(id, src) :\n      this.createLink(id, src);\n  }\n\n  createLink(id, src) {\n    $('head').append(`<link rel=\"stylesheet\" id=\"${id}\" href=\"${src}\">`);\n  }\n\n  createScript(id, src) {\n    $('head').append(`<script type=\"text/javascript\" id=\"${id}\" src=\"${src}\"></script>`);\n  }\n\n  loadPlugins() {\n    // TODO: Fix dependencies plugins load\n    const plugins = [\n      { id: \"highlitercss\", src: \"//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/styles/default.min.css\" },\n      { id: \"highliterjs\", src: \"//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js\" },\n      { id: 'echarts', src: '/public/plugins/grafana-echart-panel/lib/echarts/echarts.min.js' },\n      { id: 'liquidfill', src: '/public/plugins/grafana-echart-panel/lib/echarts/liquidfill.min.js' }\n    ];\n    plugins.filter(p => $(`#${p.id}`).length === 0)\n      .map(p => this.loadAsset(p.id, p.src));\n  }\n\n  noDataPoints() {\n    var html = '<div class=\"datapoints-warning\"><span class=\"small\">No data points</span></div>';\n    this.elem.append(html);\n  }\n\n  clearWarning() {\n    this.elem.find('.datapoints-warning').remove();\n  }\n\n  addechart() {\n    var options = this.ctrl.getChartOptions();\n    this.initEchart();\n    this.echart.setOption(options, true);\n    this.echart.resize();\n  }\n\n  initEchart() {\n    if(!this.echart)\n      this.echart = echarts.init(this.jchart[0],\n        this.panel.theme, {\n          renderer: this.panel.renderer || 'canvas'\n        });\n    return this.echart;\n  }\n\n  onRender() {\n    this.render(false);\n  }\n\n  render(incrementRenderCounter) {\n\n    if (!this.ctrl.data || !this.ctrl.data.raw.length) {\n      this.noDataPoints()\n      return;\n    }\n    if (echarts === undefined ||\n      echarts.init === undefined) {\n      setTimeout(() => this.render(incrementRenderCounter), 500);\n      return;\n    }\n\n    this.clearWarning();\n    this.addechart();\n\n    if (incrementRenderCounter) {\n      this.ctrl.renderingCompleted();\n    }\n  }\n}\n"]}